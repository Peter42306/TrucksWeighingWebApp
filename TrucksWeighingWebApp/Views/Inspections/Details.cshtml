@model TrucksWeighingWebApp.Models.Inspection

@{
    ViewData["Title"] = "Details";
    var tz = TimeZoneInfo.FindSystemTimeZoneById(Model.TimeZoneId);

}

@if (TempData["FormError"] is string fe)
{
    <div class="alert alert-danger">@fe</div>
}

<h2>@Model.Vessel</h2>

<form asp-controller="TruckRecords" asp-action="Create" method="post" class="row g-2 align-items-end">
    @Html.AntiForgeryToken()
    <input type="hidden" name="InspectionId" value="@Model.Id" />

    <div class="col-sm-2">
        <label class="form-label">Plate</label>
        <input name="PlateNumber" class="form-control" required autocomplete="off" />
    </div>

    <div class="col-sm-2">
        <label class="form-label">Initial, MT</label>
        <input name="InitialWeight" class="form-control" type="number" step="0.001" />
    </div>

    <div class="col-sm-2">
        <label class="form-label">Initial time (local)</label>
        <input name="InitialWeightAtUtc" class="form-control" type="datetime-local" />
    </div>

    <div class="col-sm-2">
        <label class="form-label">Final, MT</label>
        <input name="FinalWeight" class="form-control" type="number" step="0.001" />
    </div>

    <div class="col-sm-2">
        <label class="form-label">Final time (local)</label>
        <input name="FinalWeightAtUtc" class="form-control" type="datetime-local" />
    </div>

    <div class="col-sm-2">
        <button type="submit" class="btn btn-primary w-100">Add</button>
    </div>
</form>

<div class="table-responsive mt-3">
    <table class="table table-sm table-striped align-middle">
        <thead class="table-light">
            <tr>
                <th>#</th>
                <th>Plate</th>
                <th>Initial at (UTC)</th>
                <th class="text-end">Initial</th>
                <th>Final at (UTC)</th>
                <th class="text-end">Final</th>
                <th class="text-end">Net</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @{
                var i = 1;
                foreach (var r in Model.TruckRecords.OrderBy(x => x.Id))
                {
                    <tr>
                        <td>@i</td>
                        <td>@r.PlateNumber</td>
                        <td>@r.InitialWeightAtUtc?.ToString("yyyy-MM-dd HH:mm")</td>
                        <td class="text-end">@r.InitialWeight?.ToString("F3")</td>
                        <td>@r.FinalWeightAtUtc?.ToString("yyyy-MM-dd HH:mm")</td>
                        <td class="text-end">@r.FinalWeight?.ToString("F3")</td>
                        <td class="text-end">@r.NetWeight.ToString("F3")</td>
                        <td class="text-nowrap">
                            <a asp-controller="TruckRecords" asp-action="Edit" asp-route-id="@r.Id">Edit</a>
                        </td>
                    </tr>
                    i++;
                }
            }
        </tbody>
    </table>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}

@* <h1>Details</h1>

<div>
    <h4>Inspection</h4>
    <hr />
    <dl class="row">
        @if (User.IsInRole(RoleNames.Admin))
        {
            <dt class="col-sm-2">
                @Html.DisplayNameFor(model => model.ApplicationUser)
            </dt>
            <dd class="col-sm-10">
                @Html.DisplayFor(model => model.ApplicationUser.Email)
            </dd>
        }
        
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Vessel)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Vessel)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Cargo)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Cargo)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Place)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Place)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.DeclaredTotalWeight)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.DeclaredTotalWeight)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.CreatedAt)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.CreatedAt)
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.TimeZoneId)
        </dt>
        <dd class = "col-sm-10">
            @tz.DisplayName
        </dd>
        <dt class = "col-sm-2">
            @Html.DisplayNameFor(model => model.Notes)
        </dt>
        <dd class = "col-sm-10">
            @Html.DisplayFor(model => model.Notes)
        </dd>
    </dl>
</div>
<div>
    <a asp-action="Edit" asp-route-id="@Model?.Id">Edit</a> |
    <a asp-action="Index">Back to List</a>
</div>
 *@