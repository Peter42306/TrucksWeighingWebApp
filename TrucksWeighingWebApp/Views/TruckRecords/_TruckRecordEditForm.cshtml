@model TrucksWeighingWebApp.ViewModels.TruckRecordEditViewModel

<h4>Edit truck #@Model.SerialNumber - @Model.PlateNumber</h4>

<form asp-action="Edit" method="post" class="row g-2 align-items-end">
    @Html.AntiForgeryToken()

    <input type="hidden" asp-for="Id" />
    <input type="hidden" asp-for="InspectionId" />
    <input type="hidden" name="sortOrder" value="@(ViewData["SortOrder"])" />
    <input type="hidden" name="page" value="@(ViewData["Page"])" />
    <input type="hidden" name="pageSize" value="@(ViewData["PageSize"])" />

    
    <div class="col-lg-2 position-relative">
        <label asp-for="PlateNumber" class="form-label"></label>
        <input asp-for="PlateNumber" id="plate-edit" class="form-control" autocomplete="off"/>
        <ul id="plate-edit-suggestions"
            class="list-group position-absolute w-100"
            style="z-index:1000; max-height:200px; overflow-y:auto; display:none;">

        </ul>
        @* <span asp-validation-for="PlateNumber" class="text-danger d-none"></span> *@
    </div>

    <script>
        (function() {
          const input = document.getElementById("plate-edit");
          const list  = document.getElementById("plate-edit-suggestions");


          if (!input || !list) return;

          const form = input.closest("form");
          const inspId = form?.querySelector('input[name="InspectionId"]')?.value ?? "";

          input.addEventListener("input", async () => {
            const q = (input.value || "").trim();
            if (q.length < 1) { list.style.display="none"; list.innerHTML=""; return; }

            const res = await fetch(`/TruckRecords/PlateHints?inspectionId=${inspId}&q=${encodeURIComponent(q)}`);
            if (!res.ok) return;

            const items = await res.json();
            if (!items.length) { list.style.display="none"; list.innerHTML=""; return; }

            list.innerHTML = "";
            for (const p of items) {
              const li = document.createElement("li");
              li.className = "list-group-item list-group-item-action";
              li.textContent = p;
              li.addEventListener("click", () => {
                input.value = p;
                list.style.display = "none";
                list.innerHTML = "";
              });
              list.appendChild(li);
            }
            list.style.display = "block";
          });

          document.addEventListener("click", (e) => {
            if (!list.contains(e.target) && e.target !== input) {
              list.style.display = "none";
            }
          });
        })();
    </script>

    <div class="col-6 col-lg-2">
        <label asp-for="InitialWeight" class="form-label"></label>
        <input asp-for="InitialWeight" class="form-control" type="number" step="0.001" />
        <span asp-validation-for="InitialWeight" class="text-danger"></span>
    </div>

    <div class="col-6 col-lg-2">
        <label asp-for="InitialWeightAtUtc" class="form-label"></label>
        <input asp-for="InitialWeightAtUtc" class="form-control" type="datetime-local"/>
        <span asp-validation-for="InitialWeightAtUtc" class="text-danger"></span>
    </div>

    <div class="col-6 col-lg-2">
        <label asp-for="FinalWeight" class="form-label"></label>
        <input asp-for="FinalWeight" class="form-control" type="number" step="0.001" />
        <span asp-validation-for="FinalWeight" class="text-danger"></span>
    </div>

    <div class="col-6 col-lg-2">
        <label asp-for="FinalWeightAtUtc" class="form-label"></label>
        <input asp-for="FinalWeightAtUtc" class="form-control" type="datetime-local"/>
        <span asp-validation-for="FinalWeightAtUtc" class="text-danger"></span>
    </div>

    <div class="col-lg-2">
        <div class="row g-1">
            <div class="col-6">
                <button type="submit"
                        class="btn btn-primary w-100"
                        onclick="this.disabled = true; setTimeout(() => this.form.submit(), 300);">
                    Save
                </button>
            </div>
            <div class="col-6">
                <a class="btn btn-secondary w-100" asp-action="Index" asp-route-inspectionId="@Model.InspectionId">Cancel</a>
            </div>
        </div>
    </div>
</form>